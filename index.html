<html>
  <head>
    <title>CredSign</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/medium-editor/5.21.1/css/medium-editor.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/medium-editor/5.21.1/css/themes/tim.css">
    <link rel="stylesheet" href="/webapp/default.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/medium-editor/5.21.1/js/medium-editor.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.6/marked.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.2/react.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.2/react-dom.min.js"></script>
    <script type="text/javascript" src="/webapp/dist/app.min.js"></script>
  </head>
  <body>
    <div id="main"></div>
    <script>
      marked.setOptions({
        gfm: false,
        tables: false,
        breaks: false,
        pedantic: false,
        sanitize: true,
        smartLists: false
      });
      function getWeb3(done) {
        if (window.Web3 !== undefined) {
          window.web3 = new Web3(web3.currentProvider);
          done();
        }
        else {
          (function(d, script) {
            script = d.createElement('script');
            script.type = 'text/javascript';
            script.async = true;
            script.onload = function() {
                window.web3 = new Web3(new Web3.providers.HttpProvider(
                  window.location.protocol == 'https:' ? 'https://morden.infura.io' : 'http://localhost:8545'
                ));
                done();
            };
            script.src = 'https://unpkg.com/web3@0.16.0/dist/web3.js';
            d.getElementsByTagName('head')[0].appendChild(script);
          }(document));
        }
      }

      function getContracts(network, done) {
        (function(d, script) {
          script = d.createElement('script');
          script.type = 'text/javascript';
          script.async = true;
          script.onload = function() {
            window.credsign = web3.eth.contract(contracts.CredSign.interface).at(contracts.CredSign.address);
            window.batchread = web3.eth.contract(contracts.BatchRead.interface).at(contracts.BatchRead.address);
            done();
          };
          script.src = '/networks/'+network+'/contracts.js';
          d.getElementsByTagName('head')[0].appendChild(script);
        }(document));
      }

      getWeb3(function () {
        web3.version.getNetwork(function (error, networkID) {
          if (error) {
            console.log(error.toString());
          }
          else {
            var network = networkID == '2' ? 'testnet' : 'privnet';
            getContracts(network, function () {
              ReactDOM.render(React.createElement(window.App, null), document.getElementById('main'));
            });
          }
        });
      });
    </script>
  </body>
</html>
